<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="linux"><meta property="og:site_name" content="逃避虽然可耻但有用"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="0001-01-01T00:00:00+0000"><meta property="article:modified_time" content="2020-04-30T20:32:27+0800"><title>linux | 逃避虽然可耻但有用</title><link rel=alternate type=application/rss+xml href=https://www.leelib.com/tags/linux/atom.xml title=逃避虽然可耻但有用><link rel=stylesheet href=/css/fika.min.2121d323520ffc9463fd9137fc47ffccf72099f83ce40f24c3f32f2cae5ff47f.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon></head><body><header><div><div id=imglogo><a href=https://www.leelib.com/><img src=/img/logo.webp alt=逃避虽然可耻但有用 title=逃避虽然可耻但有用></a></div><div id=textlogo><h1 class=site-name><a href=/ title=逃避虽然可耻但有用>逃避虽然可耻但有用</a></h1><h2 class=blog-motto>少壮不努力，一生在内地</h2></div><nav class=animated><ul><li><a href=/>主页</a></li><li><a href=/archives/index.html>归档</a></li><li><a href=/about/index.html>关于</a></li><li><a href=/disappear/index.html>消失</a></li></ul></nav></div></header><div id=container><div id=main><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2020/04/30/wsl-ntfs.html title=解决WSL中使用NTFS分区的权限问题 itemprop=url>解决WSL中使用NTFS分区的权限问题</a></h1><p class=article-time><time datetime="2020-04-30 20:32:27 +0800 +0800" itemprop=datePublished>2020-04-30</time></p></header><div class=article-content><p>当使用WSL的过程中访问WSL系统以外目录时候出现一些奇奇怪怪问题
通常就是WSL对于NTFS分区的目录权限问题。</p><p>使用 <strong>mount -l</strong> 查看，可能长这样</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@wsl<span style=color:#f92672>]</span> mount -l
</span></span><span style=display:flex><span>rootfs on / type lxfs <span style=color:#f92672>(</span>rw,noatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>none on /dev type tmpfs <span style=color:#f92672>(</span>rw,noatime,mode<span style=color:#f92672>=</span>755<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>sysfs on /sys type sysfs <span style=color:#f92672>(</span>rw,nosuid,nodev,noexec,noatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>proc on /proc type proc <span style=color:#f92672>(</span>rw,nosuid,nodev,noexec,noatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>devpts on /dev/pts type devpts <span style=color:#f92672>(</span>rw,nosuid,noexec,noatime,gid<span style=color:#f92672>=</span>5,mode<span style=color:#f92672>=</span>620<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>none on /run type tmpfs <span style=color:#f92672>(</span>rw,nosuid,noexec,noatime,mode<span style=color:#f92672>=</span>755<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>none on /run/lock type tmpfs <span style=color:#f92672>(</span>rw,nosuid,nodev,noexec,noatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>none on /run/shm type tmpfs <span style=color:#f92672>(</span>rw,nosuid,nodev,noatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>none on /run/user type tmpfs <span style=color:#f92672>(</span>rw,nosuid,nodev,noexec,noatime,mode<span style=color:#f92672>=</span>755<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc <span style=color:#f92672>(</span>rw,relatime<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>cgroup on /sys/fs/cgroup type tmpfs <span style=color:#f92672>(</span>rw,relatime,mode<span style=color:#f92672>=</span>755<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>cgroup on /sys/fs/cgroup/devices type cgroup <span style=color:#f92672>(</span>rw,relatime,devices<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\ </span>on /mnt/c type drvfs <span style=color:#f92672>(</span>rw,noatime,uid<span style=color:#f92672>=</span>0,gid<span style=color:#f92672>=</span>0,case<span style=color:#f92672>=</span>off<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>D:<span style=color:#ae81ff>\ </span>on /mnt/d type drvfs <span style=color:#f92672>(</span>rw,noatime,uid<span style=color:#f92672>=</span>0,gid<span style=color:#f92672>=</span>0,case<span style=color:#f92672>=</span>off<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>可以看到 <strong>C:\</strong> 和 <strong>D:\</strong> 加载状况是这样的。这种情况下代表所有目录均以<strong>root</strong>权限进行访问。在使用<strong>ssh</strong>或<strong>git</strong>等工具的时候有可能会因为一些权限问题导致意外情况发生。</p><h3 id=解决办法很简单通过drvfs让wsl可以支持ntfs分区增加文件metadata信息>解决办法很简单，通过DrvFs让WSL可以支持NTFS分区增加文件metadata信息：</h3><ol><li>挂载配置</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#39;[automount]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled = true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>root = /mnt/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>options = &#34;metadata,umask=22,fmask=11&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>mountFsTab = false&#39;</span> &gt; /etc/wsl.conf
</span></span></code></pre></div><ol start=2><li>在<strong>PowerShell</strong>中重启WSL服务</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Restart-Service LxssManager
</span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/mount.html>mount</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/wsl.html>wsl</a>
<a href=/tags/conf.html>conf</a>
<a href=/tags/powershell.html>powershell</a>
<a href=/tags/lxss.html>lxss</a>
<a href=/tags/drvfs.html>drvfs</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2018/03/30/firewall-port-forward.html title="使用 firewall 配置端口转发" itemprop=url>使用 firewall 配置端口转发</a></h1><p class=article-time><time datetime="2018-03-30 16:36:49 +0800 +0800" itemprop=datePublished>2018-03-30</time></p></header><div class=article-content><h1 id=开启nat转发>开启NAT转发</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --zone<span style=color:#f92672>=</span>public --add-masquerade
</span></span></code></pre></div><h1 id=本机到本机>本机到本机</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --zone<span style=color:#f92672>=</span>public --add-forward-port<span style=color:#f92672>=</span>port<span style=color:#f92672>=</span>80:proto<span style=color:#f92672>=</span>tcp:toport<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>firewall-cmd --permanent --zone<span style=color:#f92672>=</span>public --add-service<span style=color:#f92672>=</span>http
</span></span></code></pre></div><h1 id=本机到其他机器>本机到其他机器</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --zone<span style=color:#f92672>=</span>public --add-forward-port<span style=color:#f92672>=</span>port<span style=color:#f92672>=</span>80:proto<span style=color:#f92672>=</span>tcp:toport<span style=color:#f92672>=</span>8080:toaddr<span style=color:#f92672>=</span>192.168.0.2
</span></span><span style=display:flex><span>firewall-cmd --permanent --zone<span style=color:#f92672>=</span>public --add-port<span style=color:#f92672>=</span>80/tcp
</span></span></code></pre></div><h1 id=重新加载应用>重新加载应用</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><h1 id=只允许指定ip连入指定端口>只允许指定IP连入指定端口</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --add-rich-rule<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;rule family=&#34;ipv4&#34; source address=&#34;192.168.0.2&#34; port protocol=&#34;tcp&#34; port=&#34;80&#34; accept&#39;</span>
</span></span></code></pre></div><h1 id=只允许指定ip段连入指定端口范围>只允许指定IP段连入指定端口范围</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --add-rich-rule<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;rule family=&#34;ipv4&#34; source address=&#34;192.168.0.0/24&#34; port protocol=&#34;tcp&#34; port=&#34;80-8080&#34; accept&#39;</span>
</span></span></code></pre></div><h1 id=linux-常用网络优化>Linux 常用网络优化</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 发送 KeepAlive 消息的间隔 1200=2分钟</span>
</span></span><span style=display:flex><span>sysctl -w net.ipv4.tcp_keepalive_time<span style=color:#f92672>=</span><span style=color:#ae81ff>1200</span>
</span></span><span style=display:flex><span><span style=color:#75715e># IP端口重用</span>
</span></span><span style=display:flex><span>sysctl -w net.ipv4.tcp_tw_reuse<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/linux.html>linux</a>
<a href=/tags/firewall.html>firewall</a>
<a href=/tags/firewall-cmd.html>firewall-cmd</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2018/03/29/iptables-port-forward.html title="使用 iptables 配置端口转发" itemprop=url>使用 iptables 配置端口转发</a></h1><p class=article-time><time datetime="2018-03-29 16:50:14 +0800 +0800" itemprop=datePublished>2018-03-29</time></p></header><div class=article-content><h2 id=配置>配置</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e># 启用IP转发功能</span>
</span></span><span style=display:flex><span>sysctl -p <span style=color:#75715e># 立即生效</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;net.ipv4.ip_forward=1&#34;</span> &gt;&gt; /usr/lib/sysctl.d/50-default.conf
</span></span><span style=display:flex><span>iptables -t nat -A POSTROUTING -j MASQUERADE
</span></span></code></pre></div><h2 id=添加端口转发脚本-portforwardsh>添加端口转发脚本 portforward.sh</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># $1=listen port</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $2=connect address and port example:111.111.111.111:2222</span>
</span></span><span style=display:flex><span>iptables -t nat -A PREROUTING -p tcp -i eno1 --dport $1 -j DNAT --to $2
</span></span></code></pre></div><p>想要添加端口的时候只要这么用就好</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./portforward.sh <span style=color:#ae81ff>22</span> 111.111.111.111:22
</span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/linux.html>linux</a>
<a href=/tags/iptables.html>iptables</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2015/01/06/linux-auth-log.html title=Linux里面查看登录日志，并统计次数和排序，查看尝试破解密码的IP itemprop=url>Linux里面查看登录日志，并统计次数和排序，查看尝试破解密码的IP</a></h1><p class=article-time><time datetime="2015-01-06 13:42:53 +0800 +0800" itemprop=datePublished>2015-01-06</time></p></header><div class=article-content><p>仅需一条命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>grep <span style=color:#e6db74>&#34;Failed password for root&#34;</span> /var/log/secure | awk <span style=color:#e6db74>&#39;{print $11}&#39;</span> | sort | uniq -c | sort -nr | more
</span></span></code></pre></div><p>结果类似下面这样：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span> 4377 103.41.124.18
</span></span><span style=display:flex><span> 4368 103.41.124.65
</span></span><span style=display:flex><span> 3900 62.210.178.226
</span></span><span style=display:flex><span> 2214 103.41.124.33
</span></span><span style=display:flex><span>  409 62.210.142.105
</span></span><span style=display:flex><span>  404 115.231.222.45
</span></span><span style=display:flex><span>  152 122.225.97.91
</span></span><span style=display:flex><span>   95 122.225.109.205
</span></span><span style=display:flex><span>   81 109.195.69.233
</span></span><span style=display:flex><span>   42 74.52.105.154
</span></span><span style=display:flex><span>   21 87.106.184.62
</span></span><span style=display:flex><span>   21 87.106.1.211
</span></span><span style=display:flex><span>   21 82.165.154.23
</span></span><span style=display:flex><span>   21 69.64.64.62
</span></span><span style=display:flex><span>   21 67.226.156.239
</span></span><span style=display:flex><span>   21 61.40.192.52
</span></span><span style=display:flex><span>   21 60.213.190.98
</span></span><span style=display:flex><span>   21 27.251.179.130
</span></span><span style=display:flex><span>   21 222.77.190.33
</span></span><span style=display:flex><span>   21 211.172.219.251
</span></span><span style=display:flex><span>   21 210.249.105.10
</span></span><span style=display:flex><span>   15 220.194.46.36
</span></span><span style=display:flex><span>   12 203.184.128.106
</span></span><span style=display:flex><span>    1 60.190.71.52
</span></span><span style=display:flex><span>    1 193.104.41.58
</span></span></code></pre></div><p>这样我们就可以很清楚的了解有谁在尝试破解我们的密码了，之后做个相关安全策略就可以简单防治了</p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/awk.html>awk</a>
<a href=/tags/grep.html>grep</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/secure.html>secure</a>
<a href=/tags/sort.html>sort</a>
<a href=/tags/uniq.html>uniq</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2014/12/30/linux-git-remote-helper-for-https.html title="Linux里Git出现fatal: Unable to find remote helper for 'https'的解决方案" itemprop=url>Linux里Git出现fatal: Unable to find remote helper for 'https'的解决方案</a></h1><p class=article-time><time datetime="2014-12-30 23:42:43 +0800 +0800" itemprop=datePublished>2014-12-30</time></p></header><div class=article-content><p>在Linux内源码编译安装的Git如果出现了 “<strong>Unable to find remote helper for &lsquo;https&rsquo;</strong>” 错误，则说明<strong>编译的时候没有发现系统有openssl开发包</strong>。</p><p>解决办法就是在编译之前安装相关的开发包就可以了。</p><h1 id=在centos系统中使用下面命令来安装>在CentOS系统中使用下面命令来安装</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel
</span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/fatal.html>fatal</a>
<a href=/tags/git.html>git</a>
<a href=/tags/https.html>https</a>
<a href=/tags/linux.html>linux</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2014/06/29/fix-yum-openssl-devel-multilib-version-problems-found.html title="解决yum安装 openssl-devel时产生的Multilib version problems found错误" itemprop=url>解决yum安装 openssl-devel时产生的Multilib version problems found错误</a></h1><p class=article-time><time datetime="2014-06-29 06:56:31 +0800 +0800" itemprop=datePublished>2014-06-29</time></p></header><div class=article-content><p>今天给一台CentOS系统安装openssl-devel时，出现了如下信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@centos<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y openssl-devel</span>
</span></span><span style=display:flex><span>Loaded plugins: fastestmirror, security
</span></span><span style=display:flex><span>Repository updates is listed more than once in the configuration
</span></span><span style=display:flex><span>Repository centosplus is listed more than once in the configuration
</span></span><span style=display:flex><span>Repository contrib is listed more than once in the configuration
</span></span><span style=display:flex><span>Repository extras is listed more than once in the configuration
</span></span><span style=display:flex><span>Loading mirror speeds from cached hostfile
</span></span><span style=display:flex><span> * base: mirrors.tuna.tsinghua.edu.cn
</span></span><span style=display:flex><span> * extras: mirrors.tuna.tsinghua.edu.cn
</span></span><span style=display:flex><span> * updates: mirrors.tuna.tsinghua.edu.cn
</span></span><span style=display:flex><span>Setting up Install Process
</span></span><span style=display:flex><span>Resolving Dependencies
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package openssl-devel.x86_64 0:1.0.1e-16.el6_5.14 will be installed
</span></span><span style=display:flex><span>--&gt; Processing Dependency: krb5-devel <span style=color:#66d9ef>for</span> package: openssl-devel-1.0.1e-16.el6_5.14.x86_64
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package krb5-devel.x86_64 0:1.10.3-15.el6_5.1 will be installed
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libselinux-devel <span style=color:#66d9ef>for</span> package: krb5-devel-1.10.3-15.el6_5.1.x86_64
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libcom_err-devel <span style=color:#66d9ef>for</span> package: krb5-devel-1.10.3-15.el6_5.1.x86_64
</span></span><span style=display:flex><span>--&gt; Processing Dependency: keyutils-libs-devel <span style=color:#66d9ef>for</span> package: krb5-devel-1.10.3-15.el6_5.1.x86_64
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package keyutils-libs-devel.x86_64 0:1.4-4.el6 will be installed
</span></span><span style=display:flex><span>---&gt; Package libcom_err-devel.x86_64 0:1.41.12-18.el6 will be installed
</span></span><span style=display:flex><span>---&gt; Package libselinux-devel.x86_64 0:2.0.94-5.3.el6_4.1 will be installed
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libselinux <span style=color:#f92672>=</span> 2.0.94-5.3.el6_4.1 <span style=color:#66d9ef>for</span> package: libselinux-devel-2.0.94-5.3.el6_4.1.x86_64
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libsepol-devel &gt;<span style=color:#f92672>=</span> 2.0.32-1 <span style=color:#66d9ef>for</span> package: libselinux-devel-2.0.94-5.3.el6_4.1.x86_64
</span></span><span style=display:flex><span>--&gt; Processing Dependency: pkgconfig<span style=color:#f92672>(</span>libsepol<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: libselinux-devel-2.0.94-5.3.el6_4.1.x86_64
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package libselinux.i686 0:2.0.94-5.3.el6_4.1 will be installed
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libdl.so.2<span style=color:#f92672>(</span>GLIBC_2.1<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libdl.so.2<span style=color:#f92672>(</span>GLIBC_2.0<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libdl.so.2 <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libc.so.6<span style=color:#f92672>(</span>GLIBC_2.8<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: ld-linux.so.2<span style=color:#f92672>(</span>GLIBC_2.3<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: ld-linux.so.2 <span style=color:#66d9ef>for</span> package: libselinux-2.0.94-5.3.el6_4.1.i686
</span></span><span style=display:flex><span>---&gt; Package libsepol-devel.x86_64 0:2.0.41-4.el6 will be installed
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package glibc.i686 0:2.12-1.132.el6_5.2 will be installed
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libfreebl3.so<span style=color:#f92672>(</span>NSSRAWHASH_3.12.3<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> package: glibc-2.12-1.132.el6_5.2.i686
</span></span><span style=display:flex><span>--&gt; Processing Dependency: libfreebl3.so <span style=color:#66d9ef>for</span> package: glibc-2.12-1.132.el6_5.2.i686
</span></span><span style=display:flex><span>--&gt; Running transaction check
</span></span><span style=display:flex><span>---&gt; Package nss-softokn-freebl.i686 0:3.14.3-10.el6_5 will be installed
</span></span><span style=display:flex><span>--&gt; Finished Dependency Resolution
</span></span><span style=display:flex><span>Error:  Multilib version problems found. This often means that the root
</span></span><span style=display:flex><span>       cause is something <span style=color:#66d9ef>else</span> and multilib version checking is just
</span></span><span style=display:flex><span>       pointing out that there is a problem. Eg.:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         1<span style=color:#ae81ff>\.</span> You have an upgrade <span style=color:#66d9ef>for</span> libselinux which is missing some
</span></span><span style=display:flex><span>            dependency that another package requires. Yum is trying to
</span></span><span style=display:flex><span>            solve this by installing an older version of libselinux of the
</span></span><span style=display:flex><span>            different architecture. If you exclude the bad architecture
</span></span><span style=display:flex><span>            yum will tell you what the root cause is <span style=color:#f92672>(</span>which package
</span></span><span style=display:flex><span>            requires what<span style=color:#f92672>)</span>. You can try redoing the upgrade with
</span></span><span style=display:flex><span>            --exclude libselinux.otherarch ... this should give you an error
</span></span><span style=display:flex><span>            message showing the root cause of the problem.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         2<span style=color:#ae81ff>\.</span> You have multiple architectures of libselinux installed, but
</span></span><span style=display:flex><span>            yum can only see an upgrade <span style=color:#66d9ef>for</span> one of those arcitectures.
</span></span><span style=display:flex><span>            If you don<span style=color:#960050;background-color:#1e0010>&#39;</span>t want/need both architectures anymore <span style=color:#66d9ef>then</span> you
</span></span><span style=display:flex><span>            can remove the one with the missing update and everything
</span></span><span style=display:flex><span>            will work.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         3<span style=color:#ae81ff>\.</span> You have duplicate versions of libselinux installed already.
</span></span><span style=display:flex><span>            You can use <span style=color:#e6db74>&#34;yum check&#34;</span> to get yum show these errors.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       ...you can also use --setopt<span style=color:#f92672>=</span>protected_multilib<span style=color:#f92672>=</span>false to remove
</span></span><span style=display:flex><span>       this checking, however this is almost never the correct thing to
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>do</span> as something <span style=color:#66d9ef>else</span> is very likely to go wrong <span style=color:#f92672>(</span>often causing
</span></span><span style=display:flex><span>       much more problems<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       Protected multilib versions: libselinux-2.0.94-5.3.el6_4.1.i686 !<span style=color:#f92672>=</span> libselinux-2.0.94-5.3.0.1.el6.centos.plus.x86_64
</span></span><span style=display:flex><span> You could try using --skip-broken to work around the problem
</span></span><span style=display:flex><span> You could try running: rpm -Va --nofiles --nodigest
</span></span></code></pre></div><p><strong>最后在一个日文的网站上找到了解决办法：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install --enablerepo<span style=color:#f92672>=</span>centosplus openssl-devel
</span></span></code></pre></div><p>参考：<a href=http://blog.urban-theory.net/2014/06/16/openssl-devel-install-fails-on-centos-with-docker>http://blog.urban-theory.net/2014/06/16/openssl-devel-install-fails-on-centos-with-docker</a></p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/centos.html>centos</a>
<a href=/tags/install.html>install</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/yum.html>yum</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2013/09/22/ubuntu-install-sublime2-with-src.html title=[摘抄笔记]sublime2在Ubuntu下命令安装以及官网压缩包安装 itemprop=url>[摘抄笔记]sublime2在Ubuntu下命令安装以及官网压缩包安装</a></h1><p class=article-time><time datetime="2013-09-22 07:57:24 +0800 +0800" itemprop=datePublished>2013-09-22</time></p></header><div class=article-content><h1 id=通过终端terminal命令安装>通过终端（terminal）命令安装</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo add-apt-repository ppa:webupd8team/sublime-text-2
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install sublime-text
</span></span></code></pre></div><h1 id=通过解压官网安装包安装>通过解压官网安装包安装</h1><ol><li>将下载的tar.bz2文件解压</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar xf Sublime Text 2.0.1 x64.tar.bz2
</span></span></code></pre></div><ol start=2><li>将解压后的文件夹移动到应用程序文件夹</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mv Sublime Text <span style=color:#ae81ff>2</span> /opt/
</span></span></code></pre></div><ol start=3><li>设置terminal快速启动命令</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ln -s /opt/Sublime Text 2/sublime_text /usr/bin/sublime
</span></span></code></pre></div><ol start=4><li>在桌面创建快捷方式</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo sublime /usr/share/applications/sublime.desktop
</span></span></code></pre></div><ol start=5><li>将下面的代码保存进去</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[Desktop Entry]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Version</span><span style=color:#f92672>=</span><span style=color:#e6db74>1.0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Name</span><span style=color:#f92672>=</span><span style=color:#e6db74>Sublime Text 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Only KDE 4 seems to use GenericName, so we reuse the KDE strings.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># From Ubuntu&#39;s language-pack-kde-XX-base packages, version 9.04-20090413.</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>GenericName</span><span style=color:#f92672>=</span><span style=color:#e6db74>Text Editor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Exec</span><span style=color:#f92672>=</span><span style=color:#e6db74>sublime</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Terminal</span><span style=color:#f92672>=</span><span style=color:#e6db74>false</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>/opt/Sublime Text 2/Icon/48x48/sublime_text.webp</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Type</span><span style=color:#f92672>=</span><span style=color:#e6db74>Application</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Categories</span><span style=color:#f92672>=</span><span style=color:#e6db74>TextEditor;IDE;Development</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>X-Ayatana-Desktop-Shortcuts</span><span style=color:#f92672>=</span><span style=color:#e6db74>NewWindow</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[NewWindow Shortcut Group]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Name</span><span style=color:#f92672>=</span><span style=color:#e6db74>New Window</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Exec</span><span style=color:#f92672>=</span><span style=color:#e6db74>sublime -n</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>TargetEnvironment</span><span style=color:#f92672>=</span><span style=color:#e6db74>Unity</span>
</span></span></code></pre></div><p>貌似安装sublime3的时候会自动创建快速启动命令，所以如果安装的是3就不用再手动设置了</p><p>摘抄自原文：<a href=http://my.oschina.net/rc6688/blog/162043#OSC_h2_4>http://my.oschina.net/rc6688/blog/162043#OSC_h2_4</a></p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/kde.html>kde</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/sublime.html>sublime</a>
<a href=/tags/ubuntu.html>ubuntu</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2013/09/06/sk-buff-2-6-18-diff-2-6-33.html title=结构体sk_buff在Linux内核2.6.18与2.6.33中的区别 itemprop=url>结构体sk_buff在Linux内核2.6.18与2.6.33中的区别</a></h1><p class=article-time><time datetime="2013-09-06 17:28:58 +0800 +0800" itemprop=datePublished>2013-09-06</time></p></header><div class=article-content><p>在Linux 2.6.33.6中，源文件在：/usr/src/kernels/2.6.33.6/include/linux/skbuff.h</p><h1 id=struct-sk_buff在2618中的定义>struct sk_buff在2.6.18中的定义：</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> sk_buff {
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* These two members must be first. */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>next;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>prev;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sock             <span style=color:#f92672>*</span>sk;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> skb_timeval      tstamp;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> net_device       <span style=color:#f92672>*</span>dev;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> net_device       <span style=color:#f92672>*</span>input_dev;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> tcphdr   <span style=color:#f92672>*</span>th;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> udphdr   <span style=color:#f92672>*</span>uh;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> icmphdr  <span style=color:#f92672>*</span>icmph;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> igmphdr  <span style=color:#f92672>*</span>igmph;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> iphdr    <span style=color:#f92672>*</span>ipiph;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> ipv6hdr  <span style=color:#f92672>*</span>ipv6h;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>   <span style=color:#f92672>*</span>raw;
</span></span><span style=display:flex><span>        } h;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> iphdr    <span style=color:#f92672>*</span>iph;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> ipv6hdr  <span style=color:#f92672>*</span>ipv6h;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> arphdr   <span style=color:#f92672>*</span>arph;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>   <span style=color:#f92672>*</span>raw;
</span></span><span style=display:flex><span>        } nh;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>   <span style=color:#f92672>*</span>raw;
</span></span><span style=display:flex><span>        } mac;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span>  dst_entry       <span style=color:#f92672>*</span>dst;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span>  sec_path        <span style=color:#f92672>*</span>sp;
</span></span><span style=display:flex><span>        <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * This is the control buffer. It is free to use for every
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * layer. Please put your private variables there. If you
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * want to keep them across layers you have to do a skb_clone()
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * first. This is owned by whoever has the skb queued ATM.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span>                    cb[<span style=color:#ae81ff>48</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>            len,
</span></span><span style=display:flex><span>                                data_len,
</span></span><span style=display:flex><span>                                mac_len,
</span></span><span style=display:flex><span>                                csum;
</span></span><span style=display:flex><span>        __u32                   priority;
</span></span><span style=display:flex><span>        __u8                    local_df:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                cloned:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                ip_summed:<span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>                                nohdr:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                nfctinfo:<span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>        __u8                    pkt_type:<span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>                                fclone:<span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span><span style=color:#75715e>#ifndef CONFIG_XEN
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                                ipvs_property:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#else
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                                ipvs_property:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                proto_data_valid:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                proto_csum_blank:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __be16                  protocol;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>void</span>                    (<span style=color:#f92672>*</span>destructor)(<span style=color:#66d9ef>struct</span> sk_buff <span style=color:#f92672>*</span>skb);
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NETFILTER
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> nf_conntrack     <span style=color:#f92672>*</span>nfct;
</span></span><span style=display:flex><span><span style=color:#75715e>#if defined(CONFIG_NF_CONNTRACK) || defined(CONFIG_NF_CONNTRACK_MODULE)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>       <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>nfct_reasm;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_BRIDGE_NETFILTER
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> nf_bridge_info   <span style=color:#f92672>*</span>nf_bridge;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u32                   nfmark;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif </span><span style=color:#75715e>/* CONFIG_NETFILTER */</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_SCHED
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u16                   tc_index;       <span style=color:#75715e>/* traffic control index */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_CLS_ACT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u16                   tc_verd;        <span style=color:#75715e>/* traffic control verdict */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_DMA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>dma_cookie_t</span>            dma_cookie;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NETWORK_SECMARK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u32                   secmark;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* These elements must be at the end, see alloc_skb() for details.  */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>            truesize;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>atomic_t</span>                users;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>           <span style=color:#f92672>*</span>head,
</span></span><span style=display:flex><span>                                <span style=color:#f92672>*</span>data,
</span></span><span style=display:flex><span>                                <span style=color:#f92672>*</span>tail,
</span></span><span style=display:flex><span>                                <span style=color:#f92672>*</span>end;
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* Extra stuff at the end to avoid breaking abi */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifndef __GENKSYMS__
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span>                      peeked;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span></code></pre></div><h1 id=struct-sk_buff在2633中的定义>struct sk_buff在2.6.33中的定义：</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> sk_buff {
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* These two members must be first. */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>next;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>prev;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>ktime_t</span>                 tstamp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sock             <span style=color:#f92672>*</span>sk;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> net_device       <span style=color:#f92672>*</span>dev;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * This is the control buffer. It is free to use for every
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * layer. Please put your private variables there. If you
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * want to keep them across layers you have to do a skb_clone()
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * first. This is owned by whoever has the skb queued ATM.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span>                    cb[<span style=color:#ae81ff>48</span>] <span style=color:#a6e22e>__aligned</span>(<span style=color:#ae81ff>8</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span>           _skb_dst;
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_XFRM
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span>  sec_path        <span style=color:#f92672>*</span>sp;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>            len,
</span></span><span style=display:flex><span>                                data_len;
</span></span><span style=display:flex><span>        __u16                   mac_len,
</span></span><span style=display:flex><span>                                hdr_len;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>                __wsum          csum;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>                        __u16   csum_start;
</span></span><span style=display:flex><span>                        __u16   csum_offset;
</span></span><span style=display:flex><span>                };
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        __u32                   priority;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>kmemcheck_bitfield_begin</span>(flags1);
</span></span><span style=display:flex><span>        __u8                    local_df:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                cloned:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                ip_summed:<span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>                                nohdr:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                nfctinfo:<span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>        __u8                    pkt_type:<span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>                                fclone:<span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>                                ipvs_property:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                peeked:<span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                                nf_trace:<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        __be16                  protocol:<span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>kmemcheck_bitfield_end</span>(flags1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>void</span>                    (<span style=color:#f92672>*</span>destructor)(<span style=color:#66d9ef>struct</span> sk_buff <span style=color:#f92672>*</span>skb);
</span></span><span style=display:flex><span><span style=color:#75715e>#if defined(CONFIG_NF_CONNTRACK) || defined(CONFIG_NF_CONNTRACK_MODULE)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> nf_conntrack     <span style=color:#f92672>*</span>nfct;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>struct</span> sk_buff          <span style=color:#f92672>*</span>nfct_reasm;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_BRIDGE_NETFILTER
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> nf_bridge_info   <span style=color:#f92672>*</span>nf_bridge;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span>                     skb_iif;
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_SCHED
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u16                   tc_index;       <span style=color:#75715e>/* traffic control index */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_CLS_ACT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u16                   tc_verd;        <span style=color:#75715e>/* traffic control verdict */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>kmemcheck_bitfield_begin</span>(flags2);
</span></span><span style=display:flex><span>        __u16                   queue_mapping:<span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_IPV6_NDISC_NODETYPE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u8                    ndisc_nodetype:<span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>kmemcheck_bitfield_end</span>(flags2);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* 0/14 bit hole */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NET_DMA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>dma_cookie_t</span>            dma_cookie;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e>#ifdef CONFIG_NETWORK_SECMARK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        __u32                   secmark;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>                __u32           mark;
</span></span><span style=display:flex><span>                __u32           dropcount;
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        __u16                   vlan_tci;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>sk_buff_data_t</span>          transport_header;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>sk_buff_data_t</span>          network_header;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>sk_buff_data_t</span>          mac_header;
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* These elements must be at the end, see alloc_skb() for details.  */</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>sk_buff_data_t</span>          tail;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>sk_buff_data_t</span>          end;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>           <span style=color:#f92672>*</span>head,
</span></span><span style=display:flex><span>                                <span style=color:#f92672>*</span>data;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>            truesize;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>atomic_t</span>                users;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>有了以上定义的话，我们就可以做类似如下定义来使我们的驱动支持多内核了：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> sk_buff <span style=color:#f92672>*</span>new_skb;
</span></span><span style=display:flex><span><span style=color:#75715e>#if LINUX_VERSION_CODE &lt;= KERNEL_VERSION(2,6,18)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>new_skb<span style=color:#f92672>-&gt;</span>mac.raw <span style=color:#f92672>=</span> (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)new_eth_p;
</span></span><span style=display:flex><span><span style=color:#75715e>#else
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>new_skb<span style=color:#f92672>-&gt;</span>mac_header <span style=color:#f92672>=</span> (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)new_eth_p;
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span></code></pre></div><p>参考：<a href=http://www.linuxquestions.org/questions/linux-kernel-70/struct-sk_buff-differs-in-2-6-18-and-2-6-33-kernel-882507/>http://www.linuxquestions.org/questions/linux-kernel-70/struct-sk_buff-differs-in-2-6-18-and-2-6-33-kernel-882507/</a></p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/driver.html>Driver</a>
<a href=/tags/inux_version_code.html>INUX_VERSION_CODE</a>
<a href=/tags/kernel.html>kernel</a>
<a href=/tags/kernel_version.html>KERNEL_VERSION</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/sk_buff.html>sk_buff</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2013/06/29/use-zlib-exp.html title=一句话经验zlib itemprop=url>一句话经验zlib</a></h1><p class=article-time><time datetime="2013-06-29 04:27:00 +0800 +0800" itemprop=datePublished>2013-06-29</time></p></header><div class=article-content><p>Linux使用gcc编译使用zlib库的代码时，使用 <strong>-lz</strong> 来链接(link) <strong>zlib</strong> 库。</p><p>否则就会出现类似 <strong>undefined reference to `deflateInit_&rsquo;</strong> 的错误</p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/programing.html>programing</a></div><div class=article-tags><span></span>
<a href=/tags/gcc.html>gcc</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/zlib.html>zlib</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2013/06/08/tcpdump-error.html title="Linux调用tcpdump时“tcpdump: USB link-layer type filtering not implemented”解决方案" itemprop=url>Linux调用tcpdump时“tcpdump: USB link-layer type filtering not implemented”解决方案</a></h1><p class=article-time><time datetime="2013-06-08 03:00:30 +0800 +0800" itemprop=datePublished>2013-06-08</time></p></header><div class=article-content><p>当调用tcpdump时，出现错误：<strong>tcpdump: USB link-layer type filtering not implemented</strong></p><h1 id=原因>原因</h1><p>说明系统可能有多块网卡共存。</p><h1 id=需要指定工作网卡才能开始截包使用参数举例>需要指定工作网卡才能开始截包，使用参数举例</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@centos<span style=color:#f92672>]</span><span style=color:#75715e># tcpdump -i eth0 udp port 53</span>
</span></span></code></pre></div><p><em>在实际使用中例子中“eth0”“udp”“53”等参数，要根据实际需要来进行修改。</em>
<em>虽然一般单网卡默认名称应该是eth0，但也有其他情况。实际中要使用ifconfig查看自己需要使用的网卡。</em></p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/linux.html>linux</a></div><div class=article-tags><span></span>
<a href=/tags/ifconfig.html>ifconfig</a>
<a href=/tags/linux.html>linux</a>
<a href=/tags/netcap.html>netcap</a>
<a href=/tags/tcpdump.html>tcpdump</a></div></div></footer></article><nav id=page-nav class=clearfix><a class="page-number current" aria-label="Page 1" role=button>1</a>
<a class=page-number href=/tags/linux/page/2.html aria-label="Page 2" role=button>2</a>
<a class="extend last" aria-label=Last rel=last role=button href=/tags/linux/page/2.html>尾页<span></span></a>
<a class="extend next" aria-label=Next rel=next role=button href=/tags/linux/page/2.html>下一页<span></span></a></nav></div><div id=asidepart><aside class=clearfix><p class=asidetitle>文章分类</p><div class=categorieslist><ul><li><span class=count>1</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/deploy.html title=deploy>deploy</a></li><li><span class=count>1</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/interesting.html title=interesting>interesting</a></li><li><span class=count>29</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/linux.html title=linux>linux</a></li><li><span class=count>6</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/notices.html title=notices>notices</a></li><li><span class=count>27</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/programing.html title=programing>programing</a></li><li><span class=count>1</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/sites.html title=sites>sites</a></li><li><span class=count>10</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/summarys.html title=summarys>summarys</a></li><li><span class=count>1</span><svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/works.html title=works>works</a></li></ul></div></aside><aside class=clearfix><p class=asidetitle>文章标签</p><div class=tagslist><ul class=clearfix><li><a href=/tags/c.html title=c>c<sup>3</sup></a></li><li><a href=/tags/centos.html title=centos>centos<sup>5</sup></a></li><li><a href=/tags/compress.html title=compress>compress<sup>2</sup></a></li><li><a href=/tags/conf.html title=conf>conf<sup>2</sup></a></li><li><a href=/tags/css.html title=css>css<sup>2</sup></a></li><li><a href=/tags/gcc.html title=gcc>gcc<sup>2</sup></a></li><li><a href=/tags/git.html title=git>git<sup>3</sup></a></li><li><a href=/tags/html.html title=html>html<sup>2</sup></a></li><li><a href=/tags/https.html title=https>https<sup>2</sup></a></li><li><a href=/tags/hugo.html title=hugo>hugo<sup>2</sup></a></li><li><a href=/tags/install.html title=install>install<sup>4</sup></a></li><li><a href=/tags/kernel.html title=kernel>kernel<sup>3</sup></a></li><li><a href=/tags/layout.html title=layout>layout<sup>2</sup></a></li><li><a href=/tags/libc.html title=libc>libc<sup>2</sup></a></li><li><a href=/tags/linux.html title=linux>linux<sup>12</sup></a></li><li><a href=/tags/ln.html title=ln>ln<sup>2</sup></a></li><li><a href=/tags/make.html title=make>make<sup>3</sup></a></li><li><a href=/tags/python.html title=python>python<sup>3</sup></a></li><li><a href=/tags/safeseh.html title=safeseh>safeseh<sup>2</sup></a></li><li><a href=/tags/style.html title=style>style<sup>2</sup></a></li><li><a href=/tags/sudo.html title=sudo>sudo<sup>2</sup></a></li><li><a href=/tags/ubuntu.html title=ubuntu>ubuntu<sup>8</sup></a></li><li><a href=/tags/windows.html title=windows>windows<sup>3</sup></a></li><li><a href=/tags/yum.html title=yum>yum<sup>4</sup></a></li><li><a href=/tags/zlib.html title=zlib>zlib<sup>4</sup></a></li></ul></div></aside><div class=rsspart><a href=/atom.xml class=btn target=_blank title=rss>RSS 订阅</a></div></div></div><footer><div id=footer><div class=line><div class=author></div></div><section class=info><p>Hello, this is leaker's blog in github.<br>Leaker: "Living without an aim is like sailing without a compass."</p></section><div class=social-font class=clearfix><a href=mailto:admin@leelib.com target=_blank class=icon-email title="Email Me"></a></div><p class=copyright>Powered by <a rel=noopener title=Hugo href=https://gohugo.io target=_blank>Hugo</a> and Theme by <a rel=noopener title=Fika href=https://github.com/leaker/hugo-theme-fika target=_blank>Fika</a> © 2022
<a href=/about/index.html target=_blank title=leaker>leaker</a>
<a target=_blank rel="noopener noreferrer" href=http://www.beian.miit.gov.cn/ class=report-link><img rel=nofollow title="备案号： 陕ICP备20006522号" class=report-img src=/images/report-img.webp><span class=report-link-text>陕ICP备20006522号</span></a></p></div></footer></body></html>