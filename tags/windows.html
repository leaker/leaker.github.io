<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="Windows"><meta property="og:site_name" content="逃避虽然可耻但有用"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="0001-01-01T00:00:00+0000"><meta property="article:modified_time" content="2024-01-10T22:26:31+0800"><title>Windows | 逃避虽然可耻但有用 </title><link rel=alternate type=application/rss+xml href=https://www.leelib.com/tags/windows/atom.xml title=逃避虽然可耻但有用><link rel=stylesheet href=/css/fika.min.2121d323520ffc9463fd9137fc47ffccf72099f83ce40f24c3f32f2cae5ff47f.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon></head><body><header><div><div id=imglogo><a href=https://www.leelib.com/><img src=/img/logo.webp alt=逃避虽然可耻但有用 title=逃避虽然可耻但有用></a></div><div id=textlogo><h1 class=site-name><a href=/ title=逃避虽然可耻但有用>逃避虽然可耻但有用</a></h1><h2 class=blog-motto>少壮不努力，一生在内地</h2></div><nav class=animated><ul><li><a href=/>主页</a></li><li><a href=/archives/index.html>归档</a></li><li><a href=/about/index.html>关于</a></li><li><a href=/disappear/index.html>消失</a></li></ul></nav></div></header><div id=container><div id=main><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2024/01/10/windows-runasinvoker.html title="Windows 系统内禁止某些应用以管理员程序运行(RunAsInvoker)" itemprop=url>Windows 系统内禁止某些应用以管理员程序运行(RunAsInvoker)</a></h1><p class=article-time><time datetime="2024-01-10 22:26:31 +0800 +0800" itemprop=datePublished>2024-01-10</time></p></header><div class=article-content><p>在 Windows 调试一些程序的时候，有可能会遇到程序本身编译为始终以管理员身份运行的。而这些程序在拿到管理员身份的时候会启动一些保护以检测自己是否被调试注入等等。</p><p>而我们不希望这些程序以管理员身份启动。</p><h3 id=如果是直接启动该程序我们可以使用命令>如果是直接启动该程序，我们可以使用命令：</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat><span style=display:flex><span>cmd /min /C <span style=color:#e6db74>&#34;set __COMPAT_LAYER=RUNASINVOKER &amp;&amp; start &#34;&#34; &#34;</span>(your app path)<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>替换 <strong>(your app path)</strong> 部分为你们的程序路径</p><h3 id=如果经常需要使用的话还可以把该命令集成到-windows-右键菜单里通过注册表>如果经常需要使用的话，还可以把该命令集成到 Windows 右键菜单里，通过注册表</h3><p><em>RunWithoutPrivilegeElevation.reg</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-reg data-lang=reg><span style=display:flex><span>Windows Registry Editor Version 5.00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[</span>HKEY_CLASSES_ROOT<span style=color:#66d9ef>\*\shell\Run Without Privilege Elevation]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Run Without Privilege Elevation&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[</span>HKEY_CLASSES_ROOT<span style=color:#66d9ef>\*\shell\Run Without Privilege Elevation\command]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cmd /min /C \&#34;set __COMPAT_LAYER=RUNASINVOKER &amp;&amp; start \&#34;\&#34; \&#34;%1\&#34;\&#34;&#34;</span>
</span></span></code></pre></div><p>点我下载：<a href=/files/2024/01/RunWithoutPrivilegeElevation.reg>RunWithoutPrivilegeElevation.reg</a></p><p>但有时该程序是被另外的程序启动的，这时我们就无法执行命令来启动了。
不过不用担心，Windows 还给了我们另外的方案</p><h3 id=为程序设置-compatibility-flags>为程序设置 Compatibility Flags</h3><p><em>DisableAppRunAsAdministrator.reg</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-reg data-lang=reg><span style=display:flex><span>Windows Registry Editor Version 5.00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[</span>HKEY_CURRENT_USER<span style=color:#66d9ef>\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>&#34;(your app path)&#34;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;RunAsInvoker&#34;</span>
</span></span></code></pre></div><p>替换 <strong>(your app path)</strong> 部分为你们的程序路径</p><p>设置好后，无论是谁启动的该程序，程序都无法以最高的管理员身份运行了。</p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/programing.html>Programing</a></div><div class=article-tags><span></span>
<a href=/tags/windows.html>Windows</a>
<a href=/tags/bat.html>Bat</a>
<a href=/tags/runasinvoker.html>Runasinvoker</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2015/01/16/windows-dll-freelibrary-self.html title=Windows下的DLL卸载本身模块的方法 itemprop=url>Windows下的DLL卸载本身模块的方法</a></h1><p class=article-time><time datetime="2015-01-16 01:35:37 +0800 +0800" itemprop=datePublished>2015-01-16</time></p></header><div class=article-content><p>在 Windows 里 DLL 卸载自身模块是无法通过字节调用 FreeLibrary 自己来实现的。</p><h2 id=原因分析>原因分析</h2><blockquote><p>在当前线程中调用 FreeLibrary 后，当前模块就会立即被释放掉，而当前线程还没有运行结束。所以程序就运行到了一块不可访问的内存里，产生异常从而导致程序崩溃。</p></blockquote><h2 id=解决方案>解决方案</h2><blockquote><p>Windows 里面 提供了一条可以用来释放自身模块的函数 <strong>FreeLibraryAndExitThread</strong> 可以释放自身。</p></blockquote><p>函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>VOID WINAPI FreeLibraryAndExitThread(_In_ HMODULE hLibModule, _In_ DWORD dwExitCode)
</span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/programing.html>Programing</a></div><div class=article-tags><span></span>
<a href=/tags/dll.html>Dll</a>
<a href=/tags/freelibrary.html>FreeLibrary</a>
<a href=/tags/freelibraryandexitthread.html>FreeLibraryAndExitThread</a>
<a href=/tags/windows.html>Windows</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2014/12/25/git-remote-helper-for-https.html title="Windows里Git出现fatal: Unable to find remote helper for 'https'的解决方案" itemprop=url>Windows里Git出现fatal: Unable to find remote helper for 'https'的解决方案</a></h1><p class=article-time><time datetime="2014-12-25 16:10:02 +0800 +0800" itemprop=datePublished>2014-12-25</time></p></header><div class=article-content><p>在升级win8.1之后，重新安装的Git虽然可以正常使用
但遇到https时会报“<strong>Unable to find remote helper for &lsquo;https&rsquo;</strong>”的错误</p><p>网络搜索了许久未果，于是自己研究</p><blockquote><ol><li><p>检查安装的文件
结果：所有文件均完整</p></li><li><p>检查文件的访问权限
结果：所有文件当前用户均可访问</p></li><li><p>为调用的git等exe文件授予管理员运行权限
结果：问题依旧存在</p></li></ol></blockquote><p>挣扎了半天，尝试重装解决。</p><p>在重装的时候选择了 <strong>管理员权限运行</strong>
结果意外的发现重装后，https可以正常使用了。</p><p>至此问题解决。</p></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/summarys.html>Summarys</a></div><div class=article-tags><span></span>
<a href=/tags/git.html>Git</a>
<a href=/tags/https.html>Https</a>
<a href=/tags/remote.html>Remote</a>
<a href=/tags/windows.html>Windows</a></div></div></footer></article><article class="post-expand post" itemprop=articleBody><header class="article-info clearfix"><h1 itemprop=name><a href=/2013/07/01/windows-use-zlib-link-error.html title="Windows下编译使用zlib库的程序时出现“无法解析的外部符号 _compress”解决方案" itemprop=url>Windows下编译使用zlib库的程序时出现“无法解析的外部符号 _compress”解决方案</a></h1><p class=article-time><time datetime="2013-07-01 05:29:47 +0800 +0800" itemprop=datePublished>2013-07-01</time></p></header><div class=article-content><h1 id=错误描述>错误描述</h1><p><strong>error LNK2019: unresolved external symbol _compress referenced</strong></p><h1 id=解决方案>解决方案</h1><p>在 <strong>#include &lt;zlib.h></strong> 之前加上 <strong>#define ZLIB_WINAPI</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#define ZLIB_WINAPI
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;zlib.h&gt;</span><span style=color:#75715e>
</span></span></span></code></pre></div></div><footer class="article-footer clearfix"><div class=article-catetags><div class=article-categories><span></span>
<a class=article-category-link href=/categories/programing.html>Programing</a></div><div class=article-tags><span></span>
<a href=/tags/compress.html>Compress</a>
<a href=/tags/windows.html>Windows</a>
<a href=/tags/zlib.html>Zlib</a></div></div></footer></article><nav id=page-nav class=clearfix><a class="page-number current" aria-label="Page 1" role=button>1</a></nav></div><div id=asidepart><aside class=clearfix><p class=asidetitle>文章分类</p><div class=categorieslist><ul><li><span class=count>1</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/deploy.html title=deploy>deploy</a></li><li><span class=count>1</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/interesting.html title=interesting>interesting</a></li><li><span class=count>29</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/linux.html title=linux>linux</a></li><li><span class=count>6</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/notices.html title=notices>notices</a></li><li><span class=count>28</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/programing.html title=programing>programing</a></li><li><span class=count>1</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/sites.html title=sites>sites</a></li><li><span class=count>10</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/summarys.html title=summarys>summarys</a></li><li><span class=count>2</span>
<svg aria-label="Directory" aria-hidden="true" height="16" viewBox="0 0 16 16" width="16" data-view-component="true" class="octicon mr-3"><path d="M1.75 1A1.75 1.75.0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75.0 0016 13.25v-8.5A1.75 1.75.0 0014.25 3H7.5a.25.25.0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
<a href=/categories/works.html title=works>works</a></li></ul></div></aside><aside class=clearfix><p class=asidetitle>文章标签</p><div class=tagslist><ul class=clearfix><li><a href=/tags/c.html title=c>c<sup>3</sup></a></li><li><a href=/tags/centos.html title=centos>centos<sup>5</sup></a></li><li><a href=/tags/compress.html title=compress>compress<sup>2</sup></a></li><li><a href=/tags/conf.html title=conf>conf<sup>2</sup></a></li><li><a href=/tags/css.html title=css>css<sup>2</sup></a></li><li><a href=/tags/gcc.html title=gcc>gcc<sup>2</sup></a></li><li><a href=/tags/git.html title=git>git<sup>3</sup></a></li><li><a href=/tags/html.html title=html>html<sup>2</sup></a></li><li><a href=/tags/https.html title=https>https<sup>2</sup></a></li><li><a href=/tags/hugo.html title=hugo>hugo<sup>2</sup></a></li><li><a href=/tags/install.html title=install>install<sup>4</sup></a></li><li><a href=/tags/kernel.html title=kernel>kernel<sup>3</sup></a></li><li><a href=/tags/layout.html title=layout>layout<sup>2</sup></a></li><li><a href=/tags/libc.html title=libc>libc<sup>2</sup></a></li><li><a href=/tags/linux.html title=linux>linux<sup>12</sup></a></li><li><a href=/tags/ln.html title=ln>ln<sup>2</sup></a></li><li><a href=/tags/make.html title=make>make<sup>3</sup></a></li><li><a href=/tags/mud.html title=mud>mud<sup>2</sup></a></li><li><a href=/tags/python.html title=python>python<sup>3</sup></a></li><li><a href=/tags/safeseh.html title=safeseh>safeseh<sup>2</sup></a></li><li><a href=/tags/style.html title=style>style<sup>2</sup></a></li><li><a href=/tags/sudo.html title=sudo>sudo<sup>2</sup></a></li><li><a href=/tags/ubuntu.html title=ubuntu>ubuntu<sup>8</sup></a></li><li><a href=/tags/windows.html title=windows>windows<sup>4</sup></a></li><li><a href=/tags/yum.html title=yum>yum<sup>4</sup></a></li><li><a href=/tags/zlib.html title=zlib>zlib<sup>4</sup></a></li></ul></div></aside><div class=rsspart><a href=/atom.xml class=btn target=_blank title=rss>RSS 订阅</a></div></div></div><footer><div id=footer><div class=line><div class=author></div></div><section class=info><p>Hello, this is leaker's blog in github.<br>Leaker: "Living without an aim is like sailing without a compass."</p></section><div class=social-font class=clearfix><a href=mailto:admin@leelib.com target=_blank class=icon-email title="Email Me"></a></div><p class=copyright>Powered by <a rel=noopener title=Hugo href=https://gohugo.io target=_blank>Hugo</a> and Theme by <a rel=noopener title=Fika href=https://github.com/leaker/hugo-theme-fika target=_blank>Fika</a> © 2022
<a href=/about/index.html target=_blank title=leaker>leaker</a></p></div></footer></body></html>